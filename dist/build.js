(()=>{function Se(){let e=window.webpackJsonp.push([[],{cum:(t,n,o)=>t.exports=o},[["cum"]]]);return e.m.cum=void 0,delete e.m.cum,e.c.cum=void 0,delete e.c.cum,e.c}function Oe(e,t,{walkable:n=[],exclude:o=[],maxStack:i=100}={}){try{JSON.stringify(e)}catch{return!1}if(e==null||typeof e!="object")return null;if(typeof t=="string")return e[t];let s=[e];for(;s.length;){let l=s.pop();try{if(t(l))return l}catch{}s.length>=i||(Array.isArray(l)?s.push(...l):typeof l=="object"&&l!==null&&(n.length>0?s.push(...Object.entries(l).filter(([c,u])=>n.indexOf(c)!==-1&&o.indexOf(c)===-1).map(([c,u])=>u)):s.push(...Object.values(l).filter(c=>o.indexOf(c)===-1&&l))))}return null}function q(e,t){let n=[];for(let o in e)if(e.hasOwnProperty(o)){let i=e[o].exports;i&&(i.default&&i.__esModule&&t(i.default)&&n.push(i.default),t(i)&&n.push(i))}return n}var d={modules:Se(),find:e=>q(d.modules,e)[0],findAll:e=>q(d.modules,e),findByProps:(...e)=>d.find(t=>e.every(n=>t[n]!==void 0)),findByPropsAll:(...e)=>d.findAll(t=>e.every(n=>t[n]!==void 0)),findByPrototypes:(...e)=>d.find(t=>t.prototype&&e.every(n=>t.prototype[n]!==void 0)),findByDisplayName:e=>d.find(t=>t.displayName===e),findByStrings:(...e)=>d.find(t=>Oe(t,n=>{if(typeof n=="function")return e.every(o=>n.toString().includes(o))})),findByKeywordAll:(...e)=>d.findAll(t=>e.every(n=>Object.keys(t).some(o=>o.toLowerCase().includes(n.toLowerCase()))==!0))},Qe=d.find,Xe=d.findAll,O=d.findByProps,Ze=d.findByPropsAll,et=d.findByPrototypes,U=d.findByDisplayName,tt=d.findByStrings,nt=d.findByKeywordAll,a=d;var g={constants:a.findByProps("API_HOST","APP_URL_PREFIX"),channels:a.findByProps("getChannelId","getVoiceChannelId"),Flux:a.findByProps("CachedStore","Store","connectStores"),FluxDispatcher:a.findByProps("_currentDispatchActionType","_subscriptions","_waitQueue"),i18n:a.findByProps("Messages","_requestedLocale"),React:a.findByProps("__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","createElement"),ReactDOM:a.findByProps("__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","hydrate"),Redux:a.findByProps("createStore","__DO_NOT_USE__ActionTypes")},r=g.React,z=g.ReactDOM,it=g.Flux,st=g.FluxDispatcher,at=g.Redux,lt=g.constants,ct=g.channels,ut=g.i18n,Q=g;function J(e,t,n){console[n]("%cCumcord%c",`background-color: ${t}; color: white; border-radius: 4px; padding: 0px 6px 0px 6px; font-weight: bold`,"",...e)}var Pe={log:(...e)=>{J(e,"#7289da","log")},error:(...e)=>{J(e,"red","error")},warn:(...e)=>{J(e,"red","warn")}},h=Pe;var X=a.findByProps("v4").v4,m=[];function v(e){let t=document.createElement("style");return t.className="CUMCORD_INJECTED_CSS",t.textContent=e,document.head.appendChild(t),()=>{t.remove()}}function Z(){for(let e of document.querySelectorAll(".CUMCORD_INJECTED_CSS"))e.remove()}function L(e,t,n,o){if(!(o=="before"||o=="instead"||o=="after"))throw new Error("Go fuck yourself.");if(typeof t[e]!="function")throw new Error(`${e} is not a function in ${t.constructor.name}`);if(Object.hasOwnProperty.bind(t)("CUMCORD_INJECTIONS")||(t.CUMCORD_INJECTIONS={}),!t.CUMCORD_INJECTIONS.hasOwnProperty(e)){let l=X();t.CUMCORD_INJECTIONS[e]=l}let i=t.CUMCORD_INJECTIONS[e];if(!m[i]){let l=t[e];m[i]={originalFunction:l,functionParent:t,functionName:e,hooks:{before:{},instead:{},after:{}}},t[e]=function(...c){return Me(i,c,this)}}let s=X();return m[i].hooks[o][s]=n,()=>te(i,s,o)}function Me(e,t,n){let o=m[e],i=o.hooks,s=t;for(let p in i.before){let C=i.before[p].call(n,s);Array.isArray(C)&&(s=C)}let l,c=Object.values(i.instead),u=(...p)=>o.originalFunction.call(n,...p);if(c.length>0){let p=w=>c[0].call(n,w,u);for(let w of c.slice(1)){let C=p;p=ve=>w.call(n,ve,C)}l=p(s)}else l=u(...s);for(let p in i.after){let C=i.after[p].call(n,s,l);typeof C!="undefined"&&(l=C)}return l}function ee(e,t,n){return L(e,t,n,"before")}function D(e,t,n){return L(e,t,n,"instead")}function k(e,t,n){return L(e,t,n,"after")}function te(e,t,n){let o=m[e];if(o){let i=o.hooks;if(i[n][t])return delete i[n][t],o.functionParent.CUMCORD_INJECTIONS[o.functionName]=void 0,delete o.functionParent.CUMCORD_INJECTIONS[o.functionName],Object.keys(i).every(l=>Object.values(i[l]).length==0)&&(o.functionParent[o.functionName]=o.originalFunction,delete o.functionParent.CUMCORD_INJECTIONS,m[e]=void 0,delete m[e]),!0}return!1}function ne(){for(let e in m)for(let t of Object.keys(m[e].hooks)){if(!m[e])return;let n=m[e].hooks[t];for(let o in n)te(e,o,t)}}function De(){if(!(!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent))||!indexedDB.databases)return Promise.resolve();let t;return new Promise(n=>{let o=()=>indexedDB.databases().finally(n);t=setInterval(o,100),o()}).finally(()=>clearInterval(t))}var oe=De;function H(e){return new Promise((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)})}function ke(e,t){let n=oe().then(()=>{let o=indexedDB.open(e);return o.onupgradeneeded=()=>o.result.createObjectStore(t),H(o)});return(o,i)=>n.then(s=>i(s.transaction(t,o).objectStore(t)))}var $;function re(){return $||($=ke("keyval-store","keyval")),$}function ie(e,t=re()){return t("readonly",n=>H(n.get(e)))}function N(e,t,n=re()){return n("readwrite",o=>(o.put(t,e),H(o.transaction)))}var Ne=eval,B={cache:"no-store"},se="https://cors.bridged.cc/",y={},f={};function ae(){for(let e of Object.keys(f))try{T(e)}catch{}}function S(e){return f[e]}function E(e,t){f[e]=t,N("CumcordCache",f)}function _(e){let t=S(e);if(!t)throw new Error(`Plugin ${e} not found`);if(y[e])throw new Error(`Plugin ${e} already loaded`);let n=Ne(t.js);y[e]=n;try{n.onLoad()}catch{}}function T(e){if(!S(e))throw new Error(`Plugin ${e} not found`);let n=y[e];if(n)n.onUnload(),y[e]=void 0,delete y[e];else throw new Error(`Plugin ${e} not loaded`)}function A(e){try{T(e)}catch{}f[e]=void 0,delete f[e],N("CumcordCache",f)}async function le(){let e=await ie("CumcordCache");y={},e?f=e:(await N("CumcordCache",{}),f={});for(let t of Object.keys(f))x(t)}function Be(e){let t=S(e);y[e]&&T(e),_(e),t.enabled||(t.enabled=!0,E(e,t))}function Ee(e){let t=S(e);y[e]&&T(e),t.enabled&&(t.enabled=!1,E(e,t))}function R(e){S(e).enabled?Ee(e):Be(e)}async function x(e){let t=e.replace(/\/?$/,"/"),n=new URL("plugin.json",t),o=new URL("plugin.js",t),i=!0,s=S(t),l=!1,c,u;try{c=await fetch(n,B)}catch{l=!0,c=await fetch(se+n,B)}if(c.status!=200&&!s)throw new Error("Plugin manifest not returning success");try{u=await c.json()}catch{if(!s)throw new Error("Plugin manifest cannot be parsed")}if(s)if(i=s.enabled,u){if(s.manifest.hash==u.hash&&(s.manifest!=u&&(s.manifest=u,E(t,s)),i)){_(t);return}}else{i&&_(t);return}let p;if(l?p=await await fetch(se+o,B):p=await await fetch(o,B),p.status!=200)throw new Error("Plugin not returning success");let w=await p.text();E(t,{manifest:u,js:w,enabled:i}),i&&_(t)}var _e=r.useState,Te=a.findByDisplayName("Card"),Ae=a.findByDisplayName("Header"),Re=a.findByDisplayName("Text"),K=a.findByDisplayName("Flex"),Ie=a.findByDisplayName("Markdown"),je=a.findByDisplayName("Switch"),{Separator:Ot}=a.findByProps("Separator"),ce=e=>{let t=f[e.pluginId],[n,o]=_e(t.enabled);return r.createElement(Te,{className:"cumcord-plugin-card",type:"cardPrimary",outline:!1,editable:!1},r.createElement(K,{justify:K.Justify.BETWEEN,align:K.Align.CENTER},r.createElement("div",{className:"cumcord-card-header"},r.createElement(Ae,{className:"cumcord-card-title"},t.manifest.name),r.createElement(Re,{className:"cumcord-card-author",tag:"h5"}," ","by ",r.createElement("strong",null,t.manifest.author))),r.createElement("div",{className:"cumcord-card-right"},r.createElement("div",{className:"cumcord-card-buttons"},r.createElement("svg",{onClick:()=>{A(e.pluginId),e.updatePlugins()},className:"cumcord-card-delete",xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px"},r.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}),r.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),r.createElement("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12l1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}))),r.createElement(je,{checked:n,onChange:()=>{try{R(e.pluginId),o(t.enabled)}catch{}}}))),r.createElement(Ie,null,t.manifest.description))};var ue=r.useState,Fe=a.findByDisplayName("FormTitle"),Ue=a.findByDisplayName("FormSection"),ze=a.findByDisplayName("Flex"),Je=a.findByDisplayName("TextInput"),W=a.findByProps("Sizes","Colors","Looks","DropdownSizes"),Le=a.findByDisplayName("FormDivider"),de=()=>{let[e,t]=ue(""),[n,o]=ue(Object.keys(f)),i=()=>{o(Object.keys(f))};return r.createElement(Ue,null,r.createElement(Fe,{tag:"h1"},"Plugins"),r.createElement(ze,{basis:"auto",grow:1,shrink:1},r.createElement(Je,{className:"cumcord-plugin-import",placeholder:"https://example.com/plugin",type:"text",value:e,onChange:s=>t(s)}),r.createElement(W,{color:W.Colors.BRAND,size:W.Sizes.MEDIUM,onClick:()=>{t(""),x(e).then(()=>{i()})}},"Add plugin")),r.createElement(Le,{className:"cumcord-plugin-divider"}),n.map(s=>r.createElement(ce,{updatePlugins:i,pluginId:s})))};var fe={initializeSettings:function(){v(".cumcord-plugin-card{padding:16px;margin-bottom:10px}.cumcord-plugin-import{flex-grow:1;margin-right:20px}.cumcord-plugin-divider{margin-top:20px;margin-bottom:20px}.cumcord-card-header{display:inline-block}.cumcord-card-author,.cumcord-card-title{display:inline}.cumcord-card-right{display:flex}.cumcord-card-delete{fill:var(--interactive-normal);cursor:pointer;width:20px}.cumcord-card-delete:hover{fill:var(--interactive-hover)}.cumcord-card-buttons{display:flex;margin-right:4px}");let e=a.findByDisplayName("SettingsView");k("getPredicateSections",e.prototype,(t,n)=>{let o=n.findIndex(s=>s.section=="changelog")-1;if(o<0)return n;let i=[{section:"DIVIDER"},{section:"HEADER",label:"Cumcord"},{section:"CUMCORD_PLUGINS",label:"Plugins",element:de}];return n.splice(o,0,...i),n})}};var He=eval,b=!1,P;function pe(e){if(b){if(P){h.log("Unloading previous plugin version...");try{P.onUnload()}catch(t){h.error("Failed to unload:",t)}}P=He(e),h.log("Loading new plugin version...");try{P.onLoad()}catch(t){h.error("Failed to load:",t)}}}function me(){b=!b,b==!1&&(P=void 0),h.log(`Dev mode is now ${b?"on":"off"}.`)}var $e=O("openModal").openModal,V=O("button","colorRed"),Ke=U("ConfirmModal"),We=U("Markdown");async function I({header:e="Are you sure?",confirmText:t="Confirm",cancelText:n="Cancel",content:o="Are you sure you want to do that?",type:i="neutral"}={},s=()=>{}){return new Promise(l=>{var c;switch(i.toLowerCase()){case"danger":c=V.colorRed;break;case"confirm":c=V.colorGreen;break;default:c=V.colorBrandNew;break}$e(u=>(u.transitionState===3&&(s(!1),l(!1)),r.createElement(Ke,{header:e,confirmText:t,cancelText:n,transitionState:u.transitionState,confirmButtonColor:c,onClose:()=>{s(!1),l(!1)},onCancel:()=>{s(!1),l(!1),u.onClose()},onConfirm:()=>{s(!0),l(!0),u.onClose()}},r.createElement(We,{editable:!1},o))))})}function G(e,t){var n;try{n=JSON.parse(e)}catch{return}switch(n.action.toLowerCase()){case"get_info":t.send(JSON.stringify({name:"CUMCORD_WEBSOCKET",uuid:n.uuid||Math.random(),status:"OK"}));return;case"install_plugin":if(n.url){if(!n.url.match(/^(http|https):\/\/[^ "]+$/)){t.send(JSON.stringify({name:"CUMCORD_WEBSOCKET",uuid:n.uuid||Math.random(),status:"ERROR",error:"Invalid URL."}));return}window.DiscordNative&&DiscordNative.window.focus(),I({header:"Do you want to install this plugin?",content:`Cumcord plugins can run code on your computer and can be potentially dangerous. Only click confirm if you trust the plugin from \`${n.url}\`.`,confirmText:"Install",cancelText:"Cancel",type:"danger"},o=>{if(o){x(n.url),t.send(JSON.stringify({name:"CUMCORD_WEBSOCKET",uuid:n.uuid||Math.random(),status:"OK"}));return}else{t.send(JSON.stringify({name:"CUMCORD_WEBSOCKET",uuid:n.uuid||Math.random(),status:"ERROR",error:"Plugin installation cancelled."}));return}})}else{t.send(JSON.stringify({uuid:n.uuid||Math.random(),status:"ERROR",error:"No URL provided."}));return}return;case"install_plugin_dev":b?n.code?(pe(n.code),t.send(JSON.stringify({uuid:n.uuid||Math.random(),status:"OK"}))):t.send(JSON.stringify({uuid:n.uuid||Math.random(),status:"ERROR",message:"No code provided."})):t.send(JSON.stringify({uuid:n.uuid||Math.random(),status:"ERROR",message:"Dev mode not enabled."}));return;default:return}}var j=[];function ge(){window.DiscordNative&&D("handleConnection",O("handleConnection").__proto__,(e,t)=>{let n=e[0];if(n.upgradeReq().url=="/cumcord")j.push(n),n.send("Welcome to the Cumcord websocket API :D"),n.on("message",o=>G(o,n)),n.on("close",()=>{j.splice(j.indexOf(n),1)});else return t(...e)})}function he(){if(window.DiscordNative)for(let e of j)e.close()}var Ve=a.findByDisplayName("Card"),Ge=a.findByDisplayName("Header"),Vt=a.findByDisplayName("Text"),Gt=a.findByDisplayName("Markdown"),ye=e=>r.createElement(Ve,{className:"cumcord-toast",type:"cardPrimary",outline:!1,editable:!1},r.createElement("div",{className:"cumcord-toast-header"},r.createElement(Ge,{className:"cumcord-toast-title"},e.children)));var M=document.createElement("div"),F=[];function Y(){z.render(r.createElement("div",null,F),M)}function we(){v(".cumcord-toast-container{position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:none;display:flex;flex-direction:column-reverse;align-items:flex-end;z-index:999999}.cumcord-toast{min-width:120px;min-height:50px;padding:5px;margin-right:10px;margin-bottom:10px;display:flex;justify-content:center;align-items:center;align-content:center;pointer-events:all}.cumcord-toast-title{font-size:30px;top:0;bottom:0;left:0;right:0}"),M.className="cumcord-toast-container",document.getElementById("app-mount").prepend(M),Y()}function Ce(){z.unmountComponentAtNode(M),M.remove()}function xe(e){let t=r.createElement(ye,null,e.title);F.push(t),Y();let n=()=>{F.splice(F.indexOf(t),1),Y()},o=setTimeout(()=>{n(),clearTimeout(o)},e.duration);return n}function Ye(){return ae(),he(),ne(),Ce(),Z(),window.cumcord=void 0,delete window.cumcord,!0}async function qe(){h.log("Initializing Cumcord API"),window.cumcord={uninject:Ye,modules:{webpackModules:a,common:Q},plugins:{importPlugin:x,removePlugin:A,togglePlugin:R},patcher:{before:ee,after:k,instead:D,injectCSS:v},ui:{toasts:{showToast:xe},modals:{showConfirmationModal:I}},cum:()=>h.log("8==D ~~~")},window.DiscordNative&&(window.cumcord.dev={toggleDevMode:me}),we(),le(),fe.initializeSettings(),ge()}var be=qe;if(window.cumcord)throw new Error("Cumcord is already injected");be();})();
